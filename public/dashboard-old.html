<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Bot Manager - Aternos Bot System</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            text-align: center;
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #cccccc;
            font-size: 0.9em;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
        }

        .card h3 {
            margin-bottom: 20px;
            font-size: 1.3em;
            color: #00ff88;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .btn {
            background: linear-gradient(45deg, #00ff88, #00cc6a);
            color: #000000;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.3s ease;
            margin: 5px;
            display: inline-block;
            text-decoration: none;
        }

        .btn:hover {
            background: linear-gradient(45deg, #00cc6a, #00aa55);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ff4444, #cc3333);
            color: #ffffff;
        }

        .btn-warning {
            background: linear-gradient(45deg, #f59e0b, #d97706);
            color: #ffffff;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #6b7280, #4b5563);
            color: #ffffff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            color: #cccccc;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(0, 0, 0, 0.3);
            color: white;
            font-size: 14px;
        }

        .form-input:focus {
            outline: none;
            border-color: #00ff88;
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.3);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .bot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bot-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        .bot-card.connected {
            border-left: 4px solid #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
        }

        .bot-card.disconnected {
            border-left: 4px solid #ff4444;
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.2);
        }

        .bot-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .bot-name {
            font-size: 1.2em;
            font-weight: bold;
        }

        .bot-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9em;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.online {
            background: #00ff88;
            box-shadow: 0 0 10px #00ff88;
        }

        .status-dot.offline {
            background: #ff4444;
            box-shadow: 0 0 10px #ff4444;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .bot-info {
            margin-bottom: 15px;
        }

        .bot-info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .bot-info-label {
            color: #cccccc;
        }

        .bot-info-value {
            color: #ffffff;
            font-weight: 500;
        }

        .bot-controls {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .bot-controls .btn {
            padding: 8px 16px;
            font-size: 12px;
            margin: 0;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 1.5em;
            color: #00ff88;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #fff;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .checkbox {
            width: 18px;
            height: 18px;
        }

        .log-container {
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            border-radius: 12px;
            padding: 0;
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #333;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.3);
        }

        .log-entry {
            display: flex;
            align-items: center;
            padding: 8px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }

        .log-entry:hover {
            background: rgba(255,255,255,0.05);
        }

        .log-icon {
            width: 20px;
            text-align: center;
            margin-right: 10px;
        }

        .log-time {
            color: #9ca3af;
            font-size: 11px;
            width: 70px;
            margin-right: 10px;
        }

        .log-message {
            flex: 1;
            line-height: 1.4;
        }

        .log-source {
            color: #6b7280;
            font-size: 10px;
            margin-left: 10px;
            padding: 2px 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .log-entry.log-error {
            background: rgba(239, 68, 68, 0.1);
            border-left: 3px solid #ef4444;
        }

        .log-entry.log-warn {
            background: rgba(245, 158, 11, 0.1);
            border-left: 3px solid #f59e0b;
        }

        .log-entry.log-info {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid #10b981;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2em;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .bot-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="bi bi-robot"></i> Multi-Bot Manager</h1>
            <p>Advanced Aternos Bedrock Keep-Alive System</p>
            
            <!-- Compliance Warning -->
            <div style="background: linear-gradient(45deg, #dc2626, #b91c1c); margin-top: 15px; padding: 12px; border-radius: 8px; border: 2px solid #f87171;">
                <div style="color: white; font-weight: bold; margin-bottom: 5px;">
                    <i class="bi bi-exclamation-triangle-fill"></i> ATERNOS POLICY WARNING
                </div>
                <div style="color: #fecaca; font-size: 13px;">
                    This bot may violate Aternos Terms of Service. Consider using bot-friendly hosting.
                </div>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalBots" style="color: #00ff88;">0</div>
                <div class="stat-label">Total Bots</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="runningBots" style="color: #10b981;">0</div>
                <div class="stat-label">Running</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="stoppedBots" style="color: #f59e0b;">0</div>
                <div class="stat-label">Stopped</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalServers" style="color: #3b82f6;">0</div>
                <div class="stat-label">Servers</div>
            </div>
        </div>

        <!-- Bot Management -->
        <div class="card">
            <h3><i class="bi bi-plus-circle"></i> Bot Management</h3>
            <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 20px;">
                <button class="btn" onclick="showCreateBotModal()">
                    <i class="bi bi-plus"></i> Create New Bot
                </button>
                <button class="btn btn-secondary" onclick="refreshData()">
                    <i class="bi bi-arrow-repeat"></i> Refresh
                </button>
                <button class="btn btn-warning" onclick="startAllBots()">
                    <i class="bi bi-play-fill"></i> Start All
                </button>
                <button class="btn btn-danger" onclick="stopAllBots()">
                    <i class="bi bi-stop-fill"></i> Stop All
                </button>
            </div>

            <!-- Bots Grid -->
            <div id="botsGrid" class="bot-grid">
                <!-- Bots will be loaded here -->
            </div>
        </div>

        <!-- Better Stack Monitoring -->
        <div class="card">
            <h3><i class="bi bi-heart-pulse"></i> Better Stack Monitoring</h3>
            <div id="betterStackContent">
                <div id="betterStackStatus">Loading...</div>

                <!-- Setup form -->
                <div id="betterStackSetupForm" class="setup-form" style="display: none; background: linear-gradient(45deg, #1e3a8a, #7c3aed); padding: 20px; border-radius: 10px; margin-top: 15px; border: 2px solid #3b82f6;">
                    <h4 style="color: #93c5fd; margin-bottom: 15px;"><i class="bi bi-lightning-charge"></i> Quick Setup</h4>
                    <div style="margin-bottom: 15px; color: #ddd6fe; font-size: 14px;">
                        1. Go to <a href="https://betterstack.com" target="_blank" style="color: #60a5fa;">betterstack.com</a><br>
                        2. Create Heartbeat Monitor<br>
                        3. Paste URL below → Setup
                    </div>
                    <input
                        type="text"
                        id="heartbeatUrlInput"
                        placeholder="https://betterstack.com/api/v1/heartbeat/YOUR_KEY"
                        class="form-input"
                        style="margin-bottom: 10px;"
                    >
                    <div style="display: flex; gap: 10px;">
                        <button onclick="setupBetterStack()" class="btn" style="flex: 1;">
                            <i class="bi bi-gear"></i> Setup Monitor
                        </button>
                        <button onclick="hideBetterStackSetup()" class="btn btn-secondary">
                            Cancel
                        </button>
                    </div>
                </div>

                <!-- Already configured section -->
                <div id="betterStackConfigured" style="display: none;">
                    <div style="background: linear-gradient(45deg, #059669, #0d9488); padding: 15px; border-radius: 10px; margin-top: 15px; text-align: center;">
                        <div style="color: white; font-weight: bold; margin-bottom: 10px;">✅ Monitoring Active</div>
                        <div style="color: #e6fffa; font-size: 14px; margin-bottom: 8px;">Professional 24/7 monitoring enabled</div>
                        <div style="color: #e6fffa; font-size: 12px; opacity: 0.9;" id="betterStackDetails">Heartbeat every 60 seconds</div>
                        <div style="margin-top: 10px; display: flex; gap: 8px; justify-content: center;">
                            <button onclick="showBetterStackSetup()" class="btn btn-secondary" style="font-size: 12px; padding: 6px 12px;">
                                <i class="bi bi-pencil-square"></i> Change URL
                            </button>
                            <button onclick="testBetterStackHeartbeat()" class="btn" style="font-size: 12px; padding: 6px 12px;">
                                <i class="bi bi-heart-pulse"></i> Test
                            </button>
                            <button onclick="disableBetterStack()" class="btn btn-danger" style="font-size: 12px; padding: 6px 12px;">
                                <i class="bi bi-x-circle"></i> Disable
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Deployment Info -->
                <div class="deployment-info" style="margin-top: 20px; padding: 15px; background: #2a2a2a; border-radius: 8px;">
                    <h4 style="margin: 0 0 10px 0; color: #4CAF50;">🚀 Deployment Information</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <strong>🌐 Production URL:</strong><br>
                            <a href="https://bot-aternos-6ltq.onrender.com/" target="_blank" style="color: #4CAF50;">
                                https://bot-aternos-6ltq.onrender.com/
                            </a>
                        </div>
                        <div>
                            <strong>📊 Status Page:</strong><br>
                            <a href="https://aternos.betteruptime.com/" target="_blank" style="color: #4CAF50;">
                                https://aternos.betteruptime.com/
                            </a>
                        </div>
                    </div>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="showMonitorSetupGuide()">
                            <i class="bi bi-question-circle"></i> Monitor Setup Guide
                        </button>
                        <button class="btn btn-secondary" onclick="testProductionEndpoint()">
                            <i class="bi bi-globe"></i> Test Production
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Live Logs -->
        <div class="card">
            <h3><i class="bi bi-clipboard-data"></i> Live System Logs</h3>
            
            <!-- Log Controls -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <span id="logStatus">🟡 Connecting...</span>
                    <span id="logCount" style="color: #9ca3af; font-size: 0.9em;">0 entries</span>
                </div>
                <div style="display: flex; gap: 8px;">
                    <button onclick="toggleLogStream()" id="logToggleBtn" class="btn btn-secondary">
                        <i class="bi bi-pause"></i> Pause
                    </button>
                    <button onclick="clearAllLogs()" class="btn btn-danger">
                        <i class="bi bi-trash"></i> Clear
                    </button>
                </div>
            </div>

            <!-- Log Container -->
            <div id="liveLog" class="log-container">
                <div class="log-entry">
                    <span class="log-icon">🔄</span>
                    <span class="log-time">--:--:--</span>
                    <span class="log-message">Connecting to live log stream...</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Bot Modal -->
    <div id="editBotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Edit Bot Configuration</h2>
                <span class="close" onclick="closeEditBotModal()">&times;</span>
            </div>
            <form id="editBotForm">
                <input type="hidden" id="editBotId">

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Bot Name</label>
                        <input type="text" id="editBotName" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="editBotUsername" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Server Host</label>
                        <input type="text" id="editBotHost" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Port</label>
                        <input type="number" id="editBotPort" class="form-input" min="1" max="65535" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Minecraft Version</label>
                        <input type="text" id="editBotVersion" class="form-input">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Anti-AFK Interval (ms)</label>
                        <input type="number" id="editAntiAfkInterval" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Movement Range</label>
                        <input type="number" id="editMovementRange" class="form-input" step="0.1" min="0.1" max="10">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Max Reconnect Attempts</label>
                        <input type="number" id="editMaxReconnectAttempts" class="form-input" min="1" max="100">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="editIsOfflineMode" class="checkbox">
                    <label for="editIsOfflineMode" class="form-label">Offline Mode (Cracked Server)</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="editAntiAfkEnabled" class="checkbox">
                    <label for="editAntiAfkEnabled" class="form-label">Enable Anti-AFK</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="editAutoStart" class="checkbox">
                    <label for="editAutoStart" class="form-label">Auto-start bot after restart</label>
                </div>

                <div style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeEditBotModal()">Cancel</button>
                    <button type="submit" class="btn">Save Changes</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Bot Modal -->
    <div id="createBotModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Create New Bot</h2>
                <span class="close" onclick="closeCreateBotModal()">&times;</span>
            </div>
            <form id="createBotForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Bot Name</label>
                        <input type="text" id="botName" class="form-input" placeholder="My Bot" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Username</label>
                        <input type="text" id="botUsername" class="form-input" placeholder="BotPlayer123" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Server Host</label>
                        <input type="text" id="botHost" class="form-input" placeholder="server.aternos.me" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Port</label>
                        <input type="number" id="botPort" class="form-input" placeholder="19132" min="1" max="65535" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Minecraft Version</label>
                        <input type="text" id="botVersion" class="form-input" placeholder="1.21.90" value="1.21.90">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Anti-AFK Interval (ms)</label>
                        <input type="number" id="antiAfkInterval" class="form-input" placeholder="30000" value="30000">
                    </div>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="isOfflineMode" class="checkbox">
                    <label for="isOfflineMode" class="form-label">Offline Mode (Cracked Server)</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="antiAfkEnabled" class="checkbox" checked>
                    <label for="antiAfkEnabled" class="form-label">Enable Anti-AFK</label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="autoStart" class="checkbox">
                    <label for="autoStart" class="form-label">Auto-start bot after creation</label>
                </div>

                <div style="margin-top: 20px; text-align: right;">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateBotModal()">Cancel</button>
                    <button type="submit" class="btn">Create Bot</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Monitor Setup Guide Modal -->
    <div id="monitorSetupModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title">📊 Better Stack Monitor Setup Guide</h2>
                <span class="close" onclick="closeMonitorSetupGuide()">&times;</span>
            </div>
            <div style="padding: 20px; max-height: 70vh; overflow-y: auto;">
                <div style="background: #1a1a1a; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: #4CAF50; margin-top: 0;">🎯 Step-by-Step Setup</h3>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #FFA726;">1. 🌐 Access Better Stack Dashboard</h4>
                        <p>Go to <a href="https://dashboard.render.com/" target="_blank" style="color: #4CAF50;">Render Dashboard</a> and find your deployed app.</p>
                        <p>Your production URL: <strong style="color: #4CAF50;">https://bot-aternos-6ltq.onrender.com/</strong></p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #FFA726;">2. 📊 Create Monitor in Better Stack</h4>
                        <ol style="color: #ccc;">
                            <li>Login to <a href="https://betterstack.com/" target="_blank" style="color: #4CAF50;">Better Stack</a></li>
                            <li>Go to <strong>Uptime</strong> → <strong>Monitors</strong></li>
                            <li>Click <strong>"Create Monitor"</strong></li>
                            <li>Choose <strong>"HTTP"</strong> monitor type</li>
                        </ol>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #FFA726;">3. ⚙️ Configure Monitor Settings</h4>
                        <div style="background: #2a2a2a; padding: 15px; border-radius: 8px;">
                            <p><strong>Monitor Name:</strong> <code>Aternos Bot System</code></p>
                            <p><strong>URL:</strong> <code>https://bot-aternos-6ltq.onrender.com/api/health</code></p>
                            <p><strong>Method:</strong> <code>GET</code></p>
                            <p><strong>Check Frequency:</strong> <code>1 minute</code></p>
                            <p><strong>Timeout:</strong> <code>30 seconds</code></p>
                            <p><strong>Expected Status Code:</strong> <code>200</code></p>
                        </div>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #FFA726;">4. 🔔 Setup Notifications</h4>
                        <ul style="color: #ccc;">
                            <li>Add your email for downtime alerts</li>
                            <li>Configure Discord/Slack webhooks (optional)</li>
                            <li>Set escalation policies</li>
                        </ul>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h4 style="color: #FFA726;">5. 📈 Create Status Page</h4>
                        <p>Your status page: <a href="https://aternos.betteruptime.com/" target="_blank" style="color: #4CAF50;">https://aternos.betteruptime.com/</a></p>
                        <ul style="color: #ccc;">
                            <li>Go to <strong>Status Pages</strong> in Better Stack</li>
                            <li>Add your monitor to the status page</li>
                            <li>Customize branding and colors</li>
                            <li>Enable public access</li>
                        </ul>
                    </div>

                    <div style="background: #0d4f3c; padding: 15px; border-radius: 8px; border-left: 4px solid #4CAF50;">
                        <h4 style="color: #4CAF50; margin-top: 0;">✅ Health Check Endpoint</h4>
                        <p style="margin-bottom: 10px;">Your app provides a health check endpoint:</p>
                        <p><strong>URL:</strong> <code>https://bot-aternos-6ltq.onrender.com/api/health</code></p>
                        <p><strong>Response:</strong> JSON with system status, bot count, uptime</p>
                        <button class="btn btn-secondary" onclick="testHealthEndpoint()" style="margin-top: 10px;">
                            <i class="bi bi-heart-pulse"></i> Test Health Endpoint
                        </button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="btn" onclick="closeMonitorSetupGuide()">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let bots = [];
        let logEntries = [];
        let eventSource = null;
        let logStreamActive = true;
        let updateInterval = null;
        let fastUpdateInterval = null;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎛️ Multi-Bot Dashboard initializing...');
            connectLogStream();
            loadBots();
            loadBetterStackStatus();
            loadRecentLogs(); // Load initial logs from files

            // Set update interval - more frequent for better real-time experience
            updateInterval = setInterval(() => {
                loadBots();
                loadBetterStackStatus();
            }, 5000); // Update every 5 seconds instead of 30

            // Additional fast refresh for bot status only
            const fastUpdateInterval = setInterval(() => {
                // Quick status update without full reload
                updateBotStatusOnly();
            }, 15000); // Update bot status every 15 seconds

            console.log('✅ Dashboard initialized');
        });

        // Load all bots
        async function loadBots() {
            try {
                const response = await fetch('/api/bots');
                const data = await response.json();

                if (data.success) {
                    bots = data.bots;
                    updateStatistics(data);
                    renderBots();
                } else {
                    console.error('Failed to load bots:', data.error);
                }
            } catch (error) {
                console.error('Error loading bots:', error);
            }
        }

        // Quick status update without full reload
        async function updateBotStatusOnly() {
            try {
                const response = await fetch('/api/bots');
                const data = await response.json();

                if (data.success && data.bots) {
                    // Update existing bot status without full re-render
                    data.bots.forEach(updatedBot => {
                        const existingBotIndex = bots.findIndex(bot => bot.id === updatedBot.id);
                        if (existingBotIndex !== -1) {
                            // Update only status-related fields
                            bots[existingBotIndex].status = updatedBot.status;
                            bots[existingBotIndex].isConnected = updatedBot.isConnected;

                            // Update the specific bot card in DOM
                            updateBotCardStatus(updatedBot.id, updatedBot);
                        }
                    });

                    // Update stats
                    updateStats();
                }
            } catch (error) {
                // Silently fail for quick updates to avoid spam
                console.debug('Quick status update failed:', error);
            }
        }

        // Update individual bot card status
        function updateBotCardStatus(botId, botData) {
            const botCard = document.querySelector(`[data-bot-id="${botId}"]`);
            if (!botCard) return;

            const isConnected = botData.isConnected || (botData.status && botData.status.isConnected) || false;

            // Update status indicator
            const statusIndicator = botCard.querySelector('.status-indicator');
            if (statusIndicator) {
                const statusDot = statusIndicator.querySelector('.status-dot');
                const statusText = statusIndicator.querySelector('.status-text');

                if (statusDot && statusText) {
                    statusDot.className = `status-dot ${isConnected ? 'online' : 'offline'}`;
                    statusText.textContent = isConnected ? 'Online' : 'Offline';
                }
            }

            // Update bot controls
            const controls = botCard.querySelector('.bot-controls');
            if (controls) {
                const startBtn = controls.querySelector('button[onclick*="startBot"]');
                const stopBtn = controls.querySelector('button[onclick*="stopBot"]');

                if (startBtn && stopBtn) {
                    if (isConnected) {
                        startBtn.style.display = 'none';
                        stopBtn.style.display = 'inline-block';
                    } else {
                        startBtn.style.display = 'inline-block';
                        stopBtn.style.display = 'none';
                    }
                }
            }

            // Update stats if available
            if (botData.status) {
                const statsElements = botCard.querySelectorAll('.bot-stat-value');
                if (statsElements.length >= 2) {
                    statsElements[0].textContent = botData.status.packetsSent || 0;
                    statsElements[1].textContent = botData.status.packetsReceived || 0;
                }
            }
        }

        // Update statistics
        function updateStatistics(data) {
            document.getElementById('totalBots').textContent = data.total;
            document.getElementById('runningBots').textContent = data.running;
            document.getElementById('stoppedBots').textContent = data.stopped;
            
            // Calculate unique servers
            const servers = new Set(bots.map(bot => `${bot.config.host}:${bot.config.port}`));
            document.getElementById('totalServers').textContent = servers.size;
        }

        // Render bots grid
        function renderBots() {
            const grid = document.getElementById('botsGrid');

            if (bots.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: #9ca3af;">
                        <i class="bi bi-robot" style="font-size: 3em; margin-bottom: 20px; display: block;"></i>
                        <h3>No bots configured</h3>
                        <p>Click "Create New Bot" to get started</p>
                    </div>
                `;
                return;
            }

            grid.innerHTML = bots.map(bot => {
                // Fix status detection
                const isConnected = bot.isConnected || (bot.status && bot.status.isConnected) || false;
                const hasSpawned = bot.status && bot.status.hasSpawned;
                const statusClass = isConnected ? 'connected' : 'disconnected';
                const statusText = isConnected ? (hasSpawned ? 'Online' : 'Connecting') : 'Offline';
                const statusDot = isConnected ? 'online' : 'offline';

                const uptime = formatUptime(bot.status?.uptime || 0);
                const position = bot.status?.currentPosition || { x: 0, y: 0, z: 0 };
                const shortId = bot.id.slice(0, 8);

                return `
                    <div class="bot-card ${statusClass}" data-bot-id="${bot.id}">
                        <div class="bot-header">
                            <div class="bot-name">
                                ${bot.config.name}
                                <div style="font-size: 0.7em; color: #9ca3af; margin-top: 2px;">
                                    ID: ${shortId}
                                </div>
                            </div>
                            <div class="bot-status">
                                <span class="status-dot ${statusDot}"></span>
                                ${statusText}
                            </div>
                        </div>

                        <div class="bot-info">
                            <div class="bot-info-item">
                                <span class="bot-info-label">Server:</span>
                                <span class="bot-info-value">${bot.config.host}:${bot.config.port}</span>
                            </div>
                            <div class="bot-info-item">
                                <span class="bot-info-label">Username:</span>
                                <span class="bot-info-value">${bot.config.username}</span>
                            </div>
                            <div class="bot-info-item">
                                <span class="bot-info-label">Position:</span>
                                <span class="bot-info-value">${position.x.toFixed(1)}, ${position.y.toFixed(1)}, ${position.z.toFixed(1)}</span>
                            </div>
                            <div class="bot-info-item">
                                <span class="bot-info-label">Uptime:</span>
                                <span class="bot-info-value">${uptime}</span>
                            </div>
                            <div class="bot-info-item">
                                <span class="bot-info-label">Anti-AFK:</span>
                                <span class="bot-info-value">${(bot.status?.antiAfkActive || bot.status?.antiAfk?.active) ? '🟢 Active' : '🔴 Inactive'}</span>
                            </div>
                            <div class="bot-info-item">
                                <span class="bot-info-label">Packets:</span>
                                <span class="bot-info-value">↑${(bot.status?.packetsSent || 0).toLocaleString()} ↓${(bot.status?.packetsReceived || 0).toLocaleString()}</span>
                            </div>
                        </div>

                        <div class="bot-controls">
                            ${isConnected ?
                                `<button class="btn btn-danger" onclick="stopBot('${bot.id}')">
                                    <i class="bi bi-stop"></i> Stop
                                </button>` :
                                `<button class="btn" onclick="startBot('${bot.id}')">
                                    <i class="bi bi-play"></i> Start
                                </button>`
                            }
                            <button class="btn btn-warning" onclick="restartBot('${bot.id}')">
                                <i class="bi bi-arrow-repeat"></i> Restart
                            </button>
                            <button class="btn btn-secondary" onclick="toggleAntiAfk('${bot.id}')">
                                <i class="bi bi-person-walking"></i> Anti-AFK
                            </button>
                            <button class="btn btn-secondary" onclick="editBot('${bot.id}')">
                                <i class="bi bi-pencil-square"></i> Edit
                            </button>
                            <button class="btn btn-secondary" onclick="viewBotLogs('${bot.id}')">
                                <i class="bi bi-file-text"></i> Logs
                            </button>
                            <button class="btn btn-danger" onclick="deleteBot('${bot.id}')">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Bot control functions
        async function startBot(botId) {
            try {
                const response = await fetch(`/api/bots/${botId}/start`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog(`🚀 Bot started: ${getBotName(botId)}`);
                    setTimeout(loadBots, 1000);
                } else {
                    alert(`Failed to start bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error starting bot: ${error.message}`);
            }
        }

        async function stopBot(botId) {
            try {
                const response = await fetch(`/api/bots/${botId}/stop`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog(`🛑 Bot stopped: ${getBotName(botId)}`);
                    setTimeout(loadBots, 1000);
                } else {
                    alert(`Failed to stop bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error stopping bot: ${error.message}`);
            }
        }

        async function restartBot(botId) {
            if (!confirm('Restart this bot? It will temporarily disconnect.')) return;

            try {
                const response = await fetch(`/api/bots/${botId}/restart`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog(`🔄 Bot restarted: ${getBotName(botId)}`);
                    setTimeout(loadBots, 2000);
                } else {
                    alert(`Failed to restart bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error restarting bot: ${error.message}`);
            }
        }

        async function deleteBot(botId) {
            const botName = getBotName(botId);
            if (!confirm(`Delete bot "${botName}"? This action cannot be undone.`)) return;

            try {
                const response = await fetch(`/api/bots/${botId}`, { method: 'DELETE' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog(`🗑️ Bot deleted: ${botName}`);
                    loadBots();
                } else {
                    alert(`Failed to delete bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error deleting bot: ${error.message}`);
            }
        }

        async function toggleAntiAfk(botId) {
            try {
                const response = await fetch(`/api/bots/${botId}/anti-afk/toggle`, { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog(`🚶 Anti-AFK ${data.active ? 'started' : 'stopped'}: ${getBotName(botId)}`);
                    setTimeout(loadBots, 1000);
                } else {
                    alert(`Failed to toggle anti-AFK: ${data.error}`);
                }
            } catch (error) {
                alert(`Error toggling anti-AFK: ${error.message}`);
            }
        }

        // View bot logs function
        async function viewBotLogs(botId) {
            try {
                const response = await fetch(`/api/bots/${botId}/logs?lines=50`);
                const data = await response.json();

                if (data.success) {
                    const botName = getBotName(botId);
                    const shortId = botId.slice(0, 8);

                    // Create modal for bot logs
                    const modal = document.createElement('div');
                    modal.className = 'modal';
                    modal.style.display = 'block';
                    modal.innerHTML = `
                        <div class="modal-content" style="max-width: 800px;">
                            <div class="modal-header">
                                <h2 class="modal-title">📋 ${botName} Logs (${shortId})</h2>
                                <span class="close" onclick="this.closest('.modal').remove()">&times;</span>
                            </div>
                            <div style="margin-bottom: 15px; display: flex; gap: 10px;">
                                <button class="btn btn-secondary" onclick="refreshBotLogs('${botId}', this.closest('.modal'))">
                                    <i class="bi bi-arrow-repeat"></i> Refresh
                                </button>
                                <button class="btn btn-danger" onclick="clearBotLogs('${botId}', this.closest('.modal'))">
                                    <i class="bi bi-trash"></i> Clear
                                </button>
                                <span style="color: #9ca3af; line-height: 2.5;">
                                    ${data.logs.length} entries
                                </span>
                            </div>
                            <div class="log-container" style="max-height: 500px;">
                                ${data.logs.map(log => `
                                    <div class="log-entry log-${log.type}">
                                        <span class="log-icon">${log.type === 'error' ? '❌' : log.type === 'warn' ? '⚠️' : 'ℹ️'}</span>
                                        <span class="log-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
                                        <span class="log-message">${log.message}</span>
                                        <span class="log-source">${log.source}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;

                    document.body.appendChild(modal);

                    // Close modal when clicking outside
                    modal.onclick = function(event) {
                        if (event.target === modal) {
                            modal.remove();
                        }
                    };

                } else {
                    alert(`Failed to load logs: ${data.error}`);
                }
            } catch (error) {
                alert(`Error loading logs: ${error.message}`);
            }
        }

        // Refresh bot logs in modal
        async function refreshBotLogs(botId, modal) {
            try {
                const response = await fetch(`/api/bots/${botId}/logs?lines=50`);
                const data = await response.json();

                if (data.success) {
                    const logContainer = modal.querySelector('.log-container');
                    logContainer.innerHTML = data.logs.map(log => `
                        <div class="log-entry log-${log.type}">
                            <span class="log-icon">${log.type === 'error' ? '❌' : log.type === 'warn' ? '⚠️' : 'ℹ️'}</span>
                            <span class="log-time">${new Date(log.timestamp).toLocaleTimeString()}</span>
                            <span class="log-message">${log.message}</span>
                            <span class="log-source">${log.source}</span>
                        </div>
                    `).join('');

                    // Update count
                    const countSpan = modal.querySelector('span[style*="color: #9ca3af"]');
                    if (countSpan) {
                        countSpan.textContent = `${data.logs.length} entries`;
                    }
                }
            } catch (error) {
                alert(`Error refreshing logs: ${error.message}`);
            }
        }

        // Clear bot logs
        async function clearBotLogs(botId, modal) {
            if (!confirm('Clear logs for this bot? This action cannot be undone.')) return;

            try {
                const response = await fetch(`/api/bots/${botId}/logs`, { method: 'DELETE' });
                const data = await response.json();

                if (data.success) {
                    refreshBotLogs(botId, modal);
                    addLocalLog(`🗑️ Cleared logs for: ${getBotName(botId)}`);
                } else {
                    alert(`Failed to clear logs: ${data.error}`);
                }
            } catch (error) {
                alert(`Error clearing logs: ${error.message}`);
            }
        }

        // Bulk operations
        async function startAllBots() {
            if (!confirm('Start all stopped bots?')) return;

            addLocalLog('🚀 Starting all stopped bots...');

            // Fix: Use proper status detection
            const stoppedBots = bots.filter(bot => {
                const isConnected = bot.isConnected || (bot.status && bot.status.isConnected) || false;
                return !isConnected;
            });

            if (stoppedBots.length === 0) {
                alert('No stopped bots to start!');
                return;
            }

            addLocalLog(`📋 Found ${stoppedBots.length} stopped bots to start`);

            for (const bot of stoppedBots) {
                try {
                    await startBot(bot.id);
                    await new Promise(resolve => setTimeout(resolve, 2000)); // Delay between starts
                } catch (error) {
                    addLocalLog(`❌ Failed to start ${bot.config.name}: ${error.message}`, 'error');
                }
            }

            addLocalLog('✅ Bulk start operation completed');
        }

        async function stopAllBots() {
            if (!confirm('Stop all running bots?')) return;

            addLocalLog('🛑 Stopping all running bots...');

            // Fix: Use proper status detection
            const runningBots = bots.filter(bot => {
                const isConnected = bot.isConnected || (bot.status && bot.status.isConnected) || false;
                return isConnected;
            });

            if (runningBots.length === 0) {
                alert('No running bots to stop!');
                return;
            }

            addLocalLog(`📋 Found ${runningBots.length} running bots to stop`);

            for (const bot of runningBots) {
                try {
                    await stopBot(bot.id);
                    await new Promise(resolve => setTimeout(resolve, 1000)); // Small delay
                } catch (error) {
                    addLocalLog(`❌ Failed to stop ${bot.config.name}: ${error.message}`, 'error');
                }
            }

            addLocalLog('✅ Bulk stop operation completed');
        }

        // Edit bot functions
        function editBot(botId) {
            const bot = bots.find(b => b.id === botId);
            if (!bot) {
                alert('Bot not found!');
                return;
            }

            // Populate form with current bot data
            document.getElementById('editBotId').value = bot.id;
            document.getElementById('editBotName').value = bot.config.name;
            document.getElementById('editBotUsername').value = bot.config.username;
            document.getElementById('editBotHost').value = bot.config.host;
            document.getElementById('editBotPort').value = bot.config.port;
            document.getElementById('editBotVersion').value = bot.config.version || '1.21.90';
            document.getElementById('editAntiAfkInterval').value = bot.config.antiAfk?.interval || 30000;
            document.getElementById('editMovementRange').value = bot.config.antiAfk?.movementRange || 2.0;
            document.getElementById('editMaxReconnectAttempts').value = bot.config.maxReconnectAttempts || 50;
            document.getElementById('editIsOfflineMode').checked = bot.config.isOfflineMode || false;
            document.getElementById('editAntiAfkEnabled').checked = bot.config.antiAfk?.enabled !== false;
            document.getElementById('editAutoStart').checked = bot.config.autoStart || false;

            // Show modal
            document.getElementById('editBotModal').style.display = 'block';
            addLocalLog(`📝 Editing bot: ${bot.config.name}`);
        }

        function closeEditBotModal() {
            document.getElementById('editBotModal').style.display = 'none';
            document.getElementById('editBotForm').reset();
        }

        // Handle edit bot form submission
        document.getElementById('editBotForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const botId = document.getElementById('editBotId').value;
            const formData = {
                name: document.getElementById('editBotName').value,
                username: document.getElementById('editBotUsername').value,
                host: document.getElementById('editBotHost').value,
                port: parseInt(document.getElementById('editBotPort').value),
                version: document.getElementById('editBotVersion').value,
                isOfflineMode: document.getElementById('editIsOfflineMode').checked,
                antiAfk: {
                    enabled: document.getElementById('editAntiAfkEnabled').checked,
                    interval: parseInt(document.getElementById('editAntiAfkInterval').value),
                    movementRange: parseFloat(document.getElementById('editMovementRange').value)
                },
                maxReconnectAttempts: parseInt(document.getElementById('editMaxReconnectAttempts').value),
                autoStart: document.getElementById('editAutoStart').checked
            };

            try {
                const response = await fetch(`/api/bots/${botId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    addLocalLog(`✅ Bot updated: ${formData.name}`);
                    closeEditBotModal();
                    loadBots(); // Refresh bot list
                    alert('✅ Bot configuration updated successfully!');
                } else {
                    alert(`Failed to update bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error updating bot: ${error.message}`);
            }
        });

        // Create bot modal functions
        function showCreateBotModal() {
            document.getElementById('createBotModal').style.display = 'block';
        }

        function closeCreateBotModal() {
            document.getElementById('createBotModal').style.display = 'none';
            document.getElementById('createBotForm').reset();
        }

        // Handle create bot form submission
        document.getElementById('createBotForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                name: document.getElementById('botName').value,
                username: document.getElementById('botUsername').value,
                host: document.getElementById('botHost').value,
                port: parseInt(document.getElementById('botPort').value),
                version: document.getElementById('botVersion').value,
                isOfflineMode: document.getElementById('isOfflineMode').checked,
                antiAfkEnabled: document.getElementById('antiAfkEnabled').checked,
                antiAfkInterval: parseInt(document.getElementById('antiAfkInterval').value),
                autoStart: document.getElementById('autoStart').checked
            };

            try {
                const response = await fetch('/api/bots', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();

                if (data.success) {
                    addLocalLog(`✅ Bot created: ${formData.name}`);
                    closeCreateBotModal();
                    loadBots();
                } else {
                    alert(`Failed to create bot: ${data.error}`);
                }
            } catch (error) {
                alert(`Error creating bot: ${error.message}`);
            }
        });

        // Logging functions
        function connectLogStream() {
            if (eventSource) {
                eventSource.close();
            }

            updateLogStatus('🟡 Connecting...', '#fbbf24');
            eventSource = new EventSource('/api/logs/stream');

            eventSource.onopen = () => {
                updateLogStatus('🟢 Connected', '#10b981');
                addLocalLog('📡 Connected to live log stream');
            };

            eventSource.onmessage = (event) => {
                if (!logStreamActive) return;

                try {
                    const logData = JSON.parse(event.data);
                    addServerLogEntry(logData);
                } catch (error) {
                    console.error('Error parsing log data:', error);
                }
            };

            eventSource.onerror = () => {
                updateLogStatus('🔴 Disconnected', '#ef4444');
                setTimeout(() => {
                    if (logStreamActive) {
                        connectLogStream();
                    }
                }, 3000);
            };
        }

        // Load recent logs from API (from log files)
        async function loadRecentLogs() {
            try {
                const response = await fetch('/api/logs/recent?lines=50');
                const data = await response.json();

                if (data.success && data.logs.length > 0) {
                    // Clear existing entries and add file-based logs
                    logEntries = [];

                    data.logs.forEach(log => {
                        const timestamp = new Date(log.timestamp).toLocaleTimeString();
                        const typeIcon = log.type === 'error' ? '❌' : log.type === 'warn' ? '⚠️' : 'ℹ️';

                        const entry = {
                            timestamp,
                            message: log.message,
                            type: log.type,
                            icon: typeIcon,
                            source: log.shortId || log.source || 'system',
                            botId: log.botId,
                            botName: log.botName
                        };

                        logEntries.push(entry);
                    });

                    // Sort by timestamp (newest first)
                    logEntries.sort((a, b) => {
                        const timeA = new Date(`1970-01-01 ${a.timestamp}`);
                        const timeB = new Date(`1970-01-01 ${b.timestamp}`);
                        return timeB - timeA;
                    });

                    updateLogDisplay();
                    addLocalLog(`📂 Loaded ${data.logs.length} log entries from files`);
                }
            } catch (error) {
                console.error('Error loading recent logs:', error);
                addLocalLog(`❌ Failed to load log history: ${error.message}`, 'error');
            }
        }

        function addServerLogEntry(logData) {
            const timestamp = new Date(logData.timestamp).toLocaleTimeString();
            const typeIcon = logData.type === 'error' ? '❌' : logData.type === 'warn' ? '⚠️' : 'ℹ️';

            const entry = {
                timestamp,
                message: logData.message,
                type: logData.type,
                icon: typeIcon,
                source: logData.source || 'server',
                botId: logData.botId,
                botName: logData.botName
            };

            logEntries.unshift(entry);

            if (logEntries.length > 100) {
                logEntries = logEntries.slice(0, 100);
            }

            updateLogDisplay();
        }

        function addLocalLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const typeIcon = type === 'error' ? '❌' : type === 'warn' ? '⚠️' : 'ℹ️';

            const entry = {
                timestamp,
                message,
                type,
                icon: typeIcon,
                source: 'dashboard'
            };

            logEntries.unshift(entry);

            if (logEntries.length > 100) {
                logEntries = logEntries.slice(0, 100);
            }

            updateLogDisplay();
        }

        function updateLogDisplay() {
            const logContainer = document.getElementById('liveLog');
            document.getElementById('logCount').textContent = `${logEntries.length} entries`;

            if (logEntries.length === 0) {
                logContainer.innerHTML = `
                    <div class="log-entry">
                        <span class="log-icon">📭</span>
                        <span class="log-time">--:--:--</span>
                        <span class="log-message">No logs available</span>
                    </div>
                `;
                return;
            }

            logContainer.innerHTML = logEntries.map(entry => {
                let sourceLabel = entry.source === 'dashboard' ? 'local' :
                                entry.source === 'system' ? 'sys' :
                                entry.source.startsWith('bot-') ? entry.source.replace('bot-', 'bot') :
                                entry.source;

                // Use bot name if available
                if (entry.botName && entry.botName !== 'System') {
                    sourceLabel = entry.botName.length > 8 ? entry.botName.slice(0, 8) + '...' : entry.botName;
                } else if (entry.source && entry.source.length === 8) {
                    // This is likely a short bot ID
                    sourceLabel = entry.source;
                }

                return `
                    <div class="log-entry log-${entry.type}">
                        <span class="log-icon">${entry.icon}</span>
                        <span class="log-time">${entry.timestamp}</span>
                        <span class="log-message">${entry.message}</span>
                        <span class="log-source">${sourceLabel}</span>
                    </div>
                `;
            }).join('');

            logContainer.scrollTop = 0;
        }

        function updateLogStatus(status, color) {
            const statusElement = document.getElementById('logStatus');
            statusElement.textContent = status;
            statusElement.style.color = color;
        }

        function toggleLogStream() {
            logStreamActive = !logStreamActive;
            const btn = document.getElementById('logToggleBtn');

            if (logStreamActive) {
                btn.innerHTML = '<i class="bi bi-pause"></i> Pause';
                btn.className = 'btn btn-secondary';

                if (!eventSource || eventSource.readyState === EventSource.CLOSED) {
                    connectLogStream();
                } else {
                    updateLogStatus('🟢 Connected', '#10b981');
                }
                addLocalLog('📡 Live log stream resumed');
            } else {
                btn.innerHTML = '<i class="bi bi-play"></i> Resume';
                btn.className = 'btn';
                updateLogStatus('⏸️ Paused', '#f59e0b');
                addLocalLog('⏸️ Live log stream paused');
            }
        }

        async function clearAllLogs() {
            if (!confirm('Clear all logs? This action cannot be undone.')) return;

            try {
                const response = await fetch('/api/logs/clear', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    logEntries = [];
                    updateLogDisplay();
                    addLocalLog('🗑️ All logs cleared');
                } else {
                    alert(`Failed to clear logs: ${data.error}`);
                }
            } catch (error) {
                alert(`Error clearing logs: ${error.message}`);
            }
        }

        // Utility functions
        function getBotName(botId) {
            const bot = bots.find(b => b.id === botId);
            return bot ? bot.config.name : 'Unknown Bot';
        }

        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;

            if (days > 0) {
                return `${days}d ${hours}h ${minutes}m`;
            } else if (hours > 0) {
                return `${hours}h ${minutes}m`;
            } else if (minutes > 0) {
                return `${minutes}m ${secs}s`;
            } else {
                return `${secs}s`;
            }
        }

        function refreshData() {
            addLocalLog('🔄 Refreshing data...');
            loadBots();
            loadBetterStackStatus();
        }

        // Better Stack functions
        async function loadBetterStackStatus() {
            try {
                const response = await fetch('/api/betterstack/status');
                const data = await response.json();

                if (data.success) {
                    updateBetterStackUI(data.status);
                }
            } catch (error) {
                console.error('Error loading Better Stack status:', error);
            }
        }

        function updateBetterStackUI(status) {
            const statusDiv = document.getElementById('betterStackStatus');
            const setupForm = document.getElementById('betterStackSetupForm');
            const configuredSection = document.getElementById('betterStackConfigured');
            const detailsDiv = document.getElementById('betterStackDetails');

            const isEnabled = status.enabled;
            const statusText = isEnabled ? '🟢 Enabled' : '🔴 Disabled';
            const heartbeat = isEnabled ? '✅ Active' : '❌ Not Set';

            statusDiv.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 15px;">
                    <div class="bot-info-item">
                        <span class="bot-info-label">Status:</span>
                        <span class="bot-info-value">${statusText}</span>
                    </div>
                    <div class="bot-info-item">
                        <span class="bot-info-label">Heartbeat:</span>
                        <span class="bot-info-value">${heartbeat}</span>
                    </div>
                    <div class="bot-info-item">
                        <span class="bot-info-label">Interval:</span>
                        <span class="bot-info-value">${status.interval / 1000}s</span>
                    </div>
                    <div class="bot-info-item">
                        <span class="bot-info-label">Success Rate:</span>
                        <span class="bot-info-value">${status.successRate}</span>
                    </div>
                </div>
                ${!isEnabled ? `
                    <button onclick="showBetterStackSetup()" class="btn">
                        <i class="bi bi-plus"></i> Setup Better Stack
                    </button>
                ` : ''}
            `;

            if (isEnabled) {
                setupForm.style.display = 'none';
                configuredSection.style.display = 'block';

                if (detailsDiv) {
                    detailsDiv.textContent = `Heartbeat every ${status.interval / 1000}s • ${status.totalHeartbeats} sent • ${status.successRate} success`;
                }
            } else {
                setupForm.style.display = 'none';
                configuredSection.style.display = 'none';
            }
        }

        function showBetterStackSetup() {
            document.getElementById('betterStackSetupForm').style.display = 'block';
            document.getElementById('betterStackConfigured').style.display = 'none';
            addLocalLog('📝 Better Stack setup form opened');
        }

        function hideBetterStackSetup() {
            document.getElementById('betterStackSetupForm').style.display = 'none';
            loadBetterStackStatus(); // Refresh to show current state
        }

        async function setupBetterStack() {
            const heartbeatUrl = document.getElementById('heartbeatUrlInput').value.trim();

            if (!heartbeatUrl) {
                alert('❌ Please enter your Better Stack heartbeat URL');
                return;
            }

            if (!heartbeatUrl.includes('betterstack.com/api/v1/heartbeat/')) {
                alert('❌ Invalid URL format!\n\nExpected: https://betterstack.com/api/v1/heartbeat/YOUR_KEY');
                return;
            }

            try {
                addLocalLog('⚙️ Setting up Better Stack monitoring...');

                const response = await fetch('/api/betterstack/setup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ heartbeatUrl: heartbeatUrl })
                });

                const data = await response.json();

                if (data.success) {
                    alert('✅ SUCCESS! Better Stack monitoring is now ACTIVE!');
                    document.getElementById('heartbeatUrlInput').value = '';
                    loadBetterStackStatus();
                    addLocalLog('✅ Better Stack monitoring enabled');
                } else {
                    alert(`❌ Setup failed: ${data.error}`);
                    addLocalLog(`❌ Better Stack setup failed: ${data.error}`, 'error');
                }

            } catch (error) {
                alert(`❌ Connection error: ${error.message}`);
                addLocalLog(`❌ Better Stack setup error: ${error.message}`, 'error');
            }
        }

        async function testBetterStackHeartbeat() {
            try {
                addLocalLog('💓 Testing Better Stack heartbeat...');

                const response = await fetch('/api/betterstack/test', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog('✅ Better Stack heartbeat test successful');
                    alert('✅ Heartbeat test successful!');
                } else {
                    addLocalLog(`❌ Heartbeat test failed: ${data.error}`, 'error');
                    alert(`❌ Heartbeat test failed: ${data.error}`);
                }
            } catch (error) {
                addLocalLog(`❌ Heartbeat test error: ${error.message}`, 'error');
                alert(`❌ Test error: ${error.message}`);
            }
        }

        async function disableBetterStack() {
            if (!confirm('Disable Better Stack monitoring? You can re-enable it later.')) return;

            try {
                const response = await fetch('/api/betterstack/disable', { method: 'POST' });
                const data = await response.json();

                if (data.success) {
                    addLocalLog('🛑 Better Stack monitoring disabled');
                    loadBetterStackStatus();
                } else {
                    alert(`❌ Failed to disable: ${data.error}`);
                }
            } catch (error) {
                alert(`❌ Error: ${error.message}`);
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('createBotModal');
            if (event.target === modal) {
                closeCreateBotModal();
            }
        }

        // Monitor Setup Guide functions
        function showMonitorSetupGuide() {
            document.getElementById('monitorSetupModal').style.display = 'block';
            addLocalLog('📖 Monitor setup guide opened');
        }

        function closeMonitorSetupGuide() {
            document.getElementById('monitorSetupModal').style.display = 'none';
        }

        async function testProductionEndpoint() {
            try {
                addLocalLog('🌐 Testing production endpoint...');

                const response = await fetch('https://bot-aternos-6ltq.onrender.com/api/health');
                const data = await response.json();

                if (response.ok) {
                    addLocalLog('✅ Production endpoint is healthy');
                    alert(`✅ Production endpoint is healthy!\n\nStatus: ${data.status}\nUptime: ${data.uptime}\nBots: ${data.bots?.total || 0}`);
                } else {
                    addLocalLog('❌ Production endpoint returned error', 'error');
                    alert('❌ Production endpoint returned an error');
                }
            } catch (error) {
                addLocalLog(`❌ Failed to reach production endpoint: ${error.message}`, 'error');
                alert(`❌ Failed to reach production endpoint:\n${error.message}\n\nThis might be normal if the app is sleeping on Render.`);
            }
        }

        async function testHealthEndpoint() {
            try {
                addLocalLog('💓 Testing health endpoint...');

                const response = await fetch('https://bot-aternos-6ltq.onrender.com/api/health');
                const data = await response.json();

                if (response.ok) {
                    addLocalLog('✅ Health endpoint working correctly');
                    alert(`✅ Health endpoint working correctly!\n\n${JSON.stringify(data, null, 2)}`);
                } else {
                    addLocalLog('❌ Health endpoint error', 'error');
                    alert('❌ Health endpoint returned an error');
                }
            } catch (error) {
                addLocalLog(`❌ Health endpoint test failed: ${error.message}`, 'error');
                alert(`❌ Health endpoint test failed:\n${error.message}`);
            }
        }

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (updateInterval) clearInterval(updateInterval);
            if (fastUpdateInterval) clearInterval(fastUpdateInterval);
            if (eventSource) eventSource.close();
        });
    </script>
</body>
</html>
